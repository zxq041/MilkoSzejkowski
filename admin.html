<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MilkShake Bar â€” Panel Administratora</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

  <style>
    :root{
      --primary:#FF6A00;
      --secondary:#FF9100;
      --bg:#0e0a08;
      --card:rgba(255,255,255,0.08);
      --card2:rgba(255,255,255,0.10);
      --border:rgba(255,255,255,0.14);
      --text:#fff;
      --muted:rgba(255,255,255,0.75);
      --shadow:0 18px 60px rgba(0,0,0,0.45);
      --radius:20px;
      --good:#16A34A;
      --bad:#DC2626;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:Poppins,system-ui,Segoe UI,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 15% 10%, rgba(255,106,0,0.35), transparent 60%),
        radial-gradient(900px 500px at 90% 25%, rgba(255,145,0,0.25), transparent 60%),
        radial-gradient(800px 500px at 50% 90%, rgba(255,255,255,0.06), transparent 60%),
        var(--bg);
      overflow:hidden;
    }

    .app{
      height:100%;
      display:grid;
      grid-template-columns: 290px 1fr;
    }

    /* Sidebar */
    .sidebar{
      height:100%;
      padding:22px;
      border-right:1px solid rgba(255,255,255,0.10);
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      backdrop-filter: blur(14px);
    }
    .brand{
      display:flex;
      align-items:center;
      gap:14px;
      padding:14px 14px;
      border-radius:18px;
      background: rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.10);
      box-shadow: 0 10px 35px rgba(0,0,0,0.35);
    }
    .brand img{
      width:44px;height:44px;border-radius:999px;object-fit:cover;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }
    .brand .t1{font-weight:900;letter-spacing:.2px}
    .brand .t2{font-size:.86rem;color:var(--muted)}
    .nav{
      margin-top:18px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .navbtn{
      width:100%;
      display:flex;
      align-items:center;
      gap:12px;
      padding:12px 14px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.04);
      color:#fff;
      cursor:pointer;
      transition:.18s ease;
      text-align:left;
    }
    .navbtn:hover{transform: translateY(-1px); background: rgba(255,255,255,0.06)}
    .navbtn.active{
      background: linear-gradient(135deg, rgba(255,106,0,0.35), rgba(255,145,0,0.18));
      border-color: rgba(255,145,0,0.35);
      box-shadow: 0 16px 40px rgba(0,0,0,0.25);
    }
    .navbtn i{width:18px;opacity:.95}
    .navsep{
      margin:12px 0 6px;
      font-size:.82rem;
      color: rgba(255,255,255,0.55);
      padding:0 6px;
      letter-spacing:.4px;
      text-transform:uppercase;
    }
    .sidefoot{
      margin-top:14px;
      padding:12px 14px;
      border-radius:16px;
      background: rgba(255,255,255,0.04);
      border:1px solid rgba(255,255,255,0.10);
      color:var(--muted);
      font-size:.9rem;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      background: rgba(0,0,0,0.35);
      border:1px solid rgba(255,255,255,0.12);
      font-size:.82rem;
      color:rgba(255,255,255,0.9);
      white-space:nowrap;
    }
    .dot{
      width:8px;height:8px;border-radius:99px;background:var(--bad);
      box-shadow: 0 0 0 3px rgba(220,38,38,0.18);
    }
    .dot.ok{background:var(--good); box-shadow: 0 0 0 3px rgba(22,163,74,0.18);}

    /* Main */
    .main{
      height:100%;
      overflow:auto;
      padding:22px;
    }
    .topbar{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
      margin-bottom:18px;
    }
    .topbar h1{
      font-size:1.9rem;
      line-height:1.15;
      font-weight:900;
      margin-bottom:6px;
      letter-spacing:.2px;
      background: linear-gradient(135deg, #fff, rgba(255,255,255,0.65));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }
    .topbar p{color:var(--muted);max-width:720px}
    .actions{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .btn{
      border:none;
      cursor:pointer;
      font-weight:800;
      padding:12px 14px;
      border-radius:999px;
      color:#fff;
      background: rgba(255,255,255,0.07);
      border:1px solid rgba(255,255,255,0.12);
      transition:.18s ease;
      display:inline-flex;
      gap:10px;
      align-items:center;
      white-space:nowrap;
    }
    .btn:hover{transform: translateY(-1px); background: rgba(255,255,255,0.09)}
    .btn.primary{
      background: linear-gradient(135deg, rgba(255,106,0,0.95), rgba(255,145,0,0.95));
      border-color: rgba(255,145,0,0.45);
      box-shadow: 0 14px 35px rgba(255,106,0,0.18);
    }
    .btn.danger{
      background: rgba(220,38,38,0.14);
      border-color: rgba(220,38,38,0.35);
    }

    /* Cards / grid */
    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:14px;
    }
    .card{
      grid-column: span 12;
      background: linear-gradient(180deg, var(--card), rgba(255,255,255,0.05));
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      padding:16px;
      backdrop-filter: blur(14px);
    }
    .card h2{
      font-size:1.1rem;
      margin-bottom:10px;
      font-weight:900;
      letter-spacing:.2px;
    }
    .kpis{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:14px;
      margin-top:10px;
    }
    .kpi{
      background: rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:18px;
      padding:14px;
      display:flex;
      gap:12px;
      align-items:center;
    }
    .kpi i{font-size:1.05rem;opacity:.95}
    .kpi .num{font-weight:900;font-size:1.35rem}
    .kpi .lbl{font-size:.86rem;color:var(--muted)}

    /* Table */
    table{
      width:100%;
      border-collapse:separate;
      border-spacing:0 10px;
    }
    th{
      text-align:left;
      font-size:.82rem;
      color:rgba(255,255,255,0.7);
      font-weight:800;
      padding:0 10px 6px;
      letter-spacing:.35px;
      text-transform:uppercase;
    }
    td{
      padding:12px 10px;
      background: rgba(255,255,255,0.06);
      border-top:1px solid rgba(255,255,255,0.10);
      border-bottom:1px solid rgba(255,255,255,0.10);
    }
    tr td:first-child{
      border-left:1px solid rgba(255,255,255,0.10);
      border-top-left-radius:16px;
      border-bottom-left-radius:16px;
    }
    tr td:last-child{
      border-right:1px solid rgba(255,255,255,0.10);
      border-top-right-radius:16px;
      border-bottom-right-radius:16px;
    }
    .tag{
      display:inline-flex;align-items:center;gap:8px;
      padding:6px 10px;border-radius:999px;
      background: rgba(0,0,0,0.35);
      border:1px solid rgba(255,255,255,0.12);
      font-weight:800;
      font-size:.84rem;
      white-space:nowrap;
    }
    .tag small{font-weight:700;color:rgba(255,255,255,0.7)}
    .row-actions{
      display:flex;gap:8px;align-items:center;justify-content:flex-end;flex-wrap:wrap;
    }
    .iconbtn{
      width:40px;height:40px;border-radius:14px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color:#fff;cursor:pointer;
      display:grid;place-items:center;
      transition:.15s ease;
    }
    .iconbtn:hover{transform: translateY(-1px); background: rgba(255,255,255,0.09)}
    .iconbtn.danger{border-color: rgba(220,38,38,0.35); background: rgba(220,38,38,0.10)}
    .iconbtn.ok{border-color: rgba(22,163,74,0.35); background: rgba(22,163,74,0.10)}

    /* Inputs */
    .field{
      display:flex;
      flex-direction:column;
      gap:8px;
      margin-top:10px;
    }
    .field label{font-weight:800;font-size:.9rem}
    .input, .textarea{
      width:100%;
      padding:12px 14px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.30);
      color:#fff;
      outline:none;
      font-family:Poppins;
    }
    .textarea{min-height:130px;resize:vertical}

    /* Modals */
    .modal, .lock{
      position:fixed; inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      z-index:9999;
      background: rgba(0,0,0,0.60);
      backdrop-filter: blur(14px);
      padding:22px;
    }
    .modal.show, .lock.show{display:flex}
    .modalbox{
      width:min(920px, 100%);
      border-radius:28px;
      border:1px solid rgba(255,255,255,0.16);
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06));
      box-shadow: var(--shadow);
      padding:18px;
    }
    .modalhead{
      display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px;
    }
    .modalhead h3{font-size:1.2rem;font-weight:900}
    .modalgrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    .modalgrid .field{margin-top:0}
    .modalfoot{display:flex;gap:10px;justify-content:flex-end;margin-top:12px;flex-wrap:wrap}

    /* LOCKSCREEN (PIN + keypad) */
    .lockbox{
      width:min(520px, 100%);
      border-radius:30px;
      border:1px solid rgba(255,255,255,0.18);
      background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.06));
      box-shadow: var(--shadow);
      padding:18px;
    }
    .locktop{
      display:flex;align-items:center;justify-content:space-between;gap:14px;margin-bottom:12px;
    }
    .locktop .title{
      display:flex;flex-direction:column;gap:2px
    }
    .locktop .title b{font-weight:900;font-size:1.1rem}
    .locktop .title span{color:var(--muted);font-size:.92rem}
    .pin{
      display:flex;
      gap:10px;
      justify-content:center;
      margin:14px 0 10px;
    }
    .pin .dotpin{
      width:14px;height:14px;border-radius:99px;
      background: rgba(255,255,255,0.22);
      border:1px solid rgba(255,255,255,0.18);
      box-shadow: inset 0 6px 12px rgba(0,0,0,0.25);
    }
    .pin .dotpin.filled{
      background: linear-gradient(135deg, rgba(255,106,0,1), rgba(255,145,0,1));
      border-color: rgba(255,145,0,0.55);
      box-shadow: 0 10px 25px rgba(255,106,0,0.18);
    }
    .keypad{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:12px;
      margin-top:12px;
    }
    .key{
      height:56px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.25);
      color:#fff;
      font-weight:900;
      font-size:1.15rem;
      cursor:pointer;
      transition:.15s ease;
      display:grid;place-items:center;
    }
    .key:hover{transform: translateY(-1px); background: rgba(0,0,0,0.35)}
    .key.small{font-size:1rem}
    .key.danger{border-color: rgba(220,38,38,0.35); background: rgba(220,38,38,0.10)}
    .key.ok{border-color: rgba(22,163,74,0.35); background: rgba(22,163,74,0.10)}
    .lockmsg{
      text-align:center;
      color:rgba(255,255,255,0.85);
      font-size:.92rem;
      min-height:22px;
      margin-top:10px;
    }

    /* FULLSCREEN ALERT (migawka + OK) */
    .alarm{
      position:fixed; inset:0;
      z-index:10000;
      display:none;
      align-items:center;
      justify-content:center;
      padding:22px;
      background: rgba(0,0,0,0.65);
      backdrop-filter: blur(6px);
    }
    .alarm.show{display:flex}
    .alarm.flash::before{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(700px 500px at 50% 30%, rgba(255,106,0,0.75), transparent 65%);
      animation: flash 0.55s infinite alternate;
      opacity:0.95;
    }
    @keyframes flash{
      from{opacity:.20}
      to{opacity:.85}
    }
    .alarmbox{
      position:relative;
      width:min(640px, 100%);
      border-radius:30px;
      border:1px solid rgba(255,255,255,0.20);
      background: linear-gradient(180deg, rgba(255,255,255,0.16), rgba(255,255,255,0.08));
      box-shadow: var(--shadow);
      padding:18px;
      text-align:center;
    }
    .alarmbox h3{
      font-size:1.35rem;
      font-weight:900;
      margin:8px 0 6px;
    }
    .alarmbox p{color:rgba(255,255,255,0.85)}
    .alarmbox .preview{
      margin-top:12px;
      background: rgba(0,0,0,0.35);
      border:1px solid rgba(255,255,255,0.14);
      border-radius:18px;
      padding:12px;
      text-align:left;
      font-size:.95rem;
      line-height:1.6;
    }
    .alarmbox .preview b{color:#fff}
    .alarmbox .okwrap{margin-top:14px;display:flex;justify-content:center}

    /* Responsive */
    @media (max-width: 1080px){
      .kpis{grid-template-columns: repeat(2, 1fr)}
    }
    @media (max-width: 920px){
      body{overflow:auto}
      .app{grid-template-columns: 1fr}
      .sidebar{position:sticky;top:0;z-index:50}
      .main{height:auto; overflow:visible}
      .modalgrid{grid-template-columns: 1fr}
    }
  </style>
</head>

<body>

  <!-- LOCKSCREEN -->
  <div class="lock show" id="lock">
    <div class="lockbox">
      <div class="locktop">
        <div class="title">
          <b>MilkShake Bar â€” Panel</b>
          <span>Wpisz PIN na klawiaturze ekranowej</span>
        </div>
        <span class="pill"><i class="fa-solid fa-lock"></i> PIN</span>
      </div>

      <div class="pin" aria-label="PIN">
        <div class="dotpin" id="p1"></div>
        <div class="dotpin" id="p2"></div>
        <div class="dotpin" id="p3"></div>
        <div class="dotpin" id="p4"></div>
      </div>

      <div class="keypad" id="keypad">
        <button class="key" data-k="1">1</button>
        <button class="key" data-k="2">2</button>
        <button class="key" data-k="3">3</button>
        <button class="key" data-k="4">4</button>
        <button class="key" data-k="5">5</button>
        <button class="key" data-k="6">6</button>
        <button class="key" data-k="7">7</button>
        <button class="key" data-k="8">8</button>
        <button class="key" data-k="9">9</button>
        <button class="key danger small" data-act="back"><i class="fa-solid fa-delete-left"></i></button>
        <button class="key" data-k="0">0</button>
        <button class="key ok small" data-act="ok"><i class="fa-solid fa-check"></i></button>
      </div>

      <div class="lockmsg" id="lockMsg"></div>
    </div>
  </div>

  <!-- FULLSCREEN ALARM -->
  <div class="alarm" id="alarm">
    <div class="alarmbox">
      <div class="pill" style="margin:0 auto 8px; width:max-content;">
        <i class="fa-solid fa-bell"></i> Nowa rezerwacja
      </div>
      <h3>PrzyszÅ‚a nowa rezerwacja!</h3>
      <p>Panel bÄ™dzie migaÅ‚ i piszczaÅ‚, dopÃ³ki nie klikniesz <b>OK</b>.</p>

      <div class="preview" id="alarmPreview"></div>

      <div class="okwrap">
        <button class="btn primary" id="alarmOk"><i class="fa-solid fa-check"></i> OK</button>
      </div>
    </div>
  </div>

  <div class="app" id="app" style="display:none">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="brand">
        <img src="https://i.imgur.com/Twr2Rms.jpeg" alt="Logo">
        <div>
          <div class="t1">MilkShake Bar</div>
          <div class="t2">Panel Administratora</div>
        </div>
      </div>

      <div class="nav">
        <div class="navsep">GÅ‚Ã³wne</div>
        <button class="navbtn active" data-tab="reservations"><i class="fa-solid fa-calendar-check"></i> Rezerwacje</button>
        <button class="navbtn" data-tab="happy"><i class="fa-solid fa-bullhorn"></i> Pasek info</button>

        <div class="navsep">ZarzÄ…dzanie</div>
        <button class="navbtn" data-tab="users"><i class="fa-solid fa-users"></i> UÅ¼ytkownicy</button>
        <button class="navbtn" data-tab="employees"><i class="fa-solid fa-user-tie"></i> Pracownicy</button>
        <button class="navbtn" data-tab="future"><i class="fa-solid fa-layer-group"></i> PrzyszÅ‚oÅ›ciowe zakÅ‚adki</button>

        <div class="navsep">Milk / ZamÃ³wienia</div>
        <button class="navbtn" data-tab="pickup"><i class="fa-solid fa-bag-shopping"></i> ZamÃ³wienie z odbiorem</button>
        <button class="navbtn" data-tab="points"><i class="fa-solid fa-star"></i> Punkty Milk</button>
        <button class="navbtn" data-tab="rewards"><i class="fa-solid fa-gift"></i> Nagrody</button>

        <div class="sidefoot">
          <span class="pill"><span class="dot" id="apiDot"></span> API</span>
          <span class="pill" id="clock"><i class="fa-regular fa-clock"></i> â€”</span>
        </div>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="main">
      <div class="topbar">
        <div>
          <h1 id="title">Rezerwacje</h1>
          <p id="subtitle">ZarzÄ…dzaj rezerwacjami i paskiem informacyjnym. Realtime dziaÅ‚a przez Socket.IO.</p>
        </div>

        <div class="actions">
          <button class="btn" id="refreshBtn"><i class="fa-solid fa-rotate"></i> OdÅ›wieÅ¼</button>
          <button class="btn danger" id="logoutBtn"><i class="fa-solid fa-right-from-bracket"></i> Wyloguj</button>
        </div>
      </div>

      <!-- KPIs -->
      <section class="card" id="kpiCard">
        <h2>PodglÄ…d</h2>
        <div class="kpis">
          <div class="kpi"><i class="fa-solid fa-users"></i><div><div class="num" id="kUsers">â€”</div><div class="lbl">UÅ¼ytkownicy</div></div></div>
          <div class="kpi"><i class="fa-solid fa-bag-shopping"></i><div><div class="num" id="kOrders">â€”</div><div class="lbl">ZamÃ³wienia</div></div></div>
          <div class="kpi"><i class="fa-solid fa-utensils"></i><div><div class="num" id="kProducts">â€”</div><div class="lbl">Produkty</div></div></div>
          <div class="kpi"><i class="fa-solid fa-calendar-check"></i><div><div class="num" id="kReservations">â€”</div><div class="lbl">Rezerwacje</div></div></div>
        </div>
      </section>

      <!-- TAB: RESERVATIONS -->
      <section class="card" id="tab-reservations">
        <h2>Rezerwacje</h2>
        <div style="overflow:auto">
          <table>
            <thead>
              <tr>
                <th>Data / Godzina</th>
                <th>Klient</th>
                <th>IloÅ›Ä‡</th>
                <th>Strefa</th>
                <th>Å¹rÃ³dÅ‚o</th>
                <th style="text-align:right">Akcje</th>
              </tr>
            </thead>
            <tbody id="resTbody"></tbody>
          </table>
        </div>
      </section>

      <!-- TAB: HAPPY -->
      <section class="card" id="tab-happy" style="display:none">
        <h2>Pasek info (Happy Bar)</h2>

        <div class="field">
          <label>Tekst paska</label>
          <textarea class="textarea" id="happyText" placeholder="np. Happy Hour 12:00â€“16:00 â€¢ -20% na shake'i"></textarea>
        </div>

        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;justify-content:flex-end">
          <button class="btn" id="happyLoad"><i class="fa-solid fa-download"></i> Wczytaj</button>
          <button class="btn primary" id="happySave"><i class="fa-solid fa-floppy-disk"></i> Zapisz</button>
        </div>

        <p style="margin-top:10px;color:var(--muted);font-size:.92rem">
          Zapis wywoÅ‚uje <b>POST /api/happy</b> i robi realtime update na stronie (event: <b>happy-updated</b>).
        </p>
      </section>

      <!-- PLACEHOLDER TABS -->
      <section class="card" id="tab-users" style="display:none">
        <h2>UÅ¼ytkownicy</h2>
        <p style="color:var(--muted)">Placeholder â€” TwÃ³j server.js ma kolekcjÄ™ <b>users</b>, ale nie ma jeszcze endpointÃ³w do listowania. Dodamy, gdy bÄ™dziesz chciaÅ‚.</p>
      </section>

      <section class="card" id="tab-employees" style="display:none">
        <h2>Pracownicy</h2>
        <p style="color:var(--muted)">Placeholder â€” brak endpointÃ³w w minimalnym server.js. ZakÅ‚adka gotowa pod przyszÅ‚oÅ›Ä‡.</p>
      </section>

      <section class="card" id="tab-future" style="display:none">
        <h2>PrzyszÅ‚oÅ›ciowe zakÅ‚adki</h2>
        <p style="color:var(--muted)">Placeholder â€” miejsce na nowe moduÅ‚y (np. raporty, eksport, ustawienia).</p>
      </section>

      <section class="card" id="tab-pickup" style="display:none">
        <h2>ZamÃ³wienie z odbiorem</h2>
        <p style="color:var(--muted)">Placeholder â€” kolekcja <b>orders</b> istnieje, ale brak endpointÃ³w w tym minimalnym server.js.</p>
      </section>

      <section class="card" id="tab-points" style="display:none">
        <h2>Punkty Milk</h2>
        <p style="color:var(--muted)">Placeholder â€” do podpiÄ™cia API punktÃ³w (w przyszÅ‚oÅ›ci).</p>
      </section>

      <section class="card" id="tab-rewards" style="display:none">
        <h2>Nagrody</h2>
        <p style="color:var(--muted)">Placeholder â€” do podpiÄ™cia API nagrÃ³d (w przyszÅ‚oÅ›ci).</p>
      </section>
    </main>
  </div>

  <!-- EDIT MODAL -->
  <div class="modal" id="editModal" aria-hidden="true">
    <div class="modalbox">
      <div class="modalhead">
        <h3>Edycja rezerwacji</h3>
        <button class="iconbtn" id="editClose" title="Zamknij"><i class="fa-solid fa-xmark"></i></button>
      </div>

      <div class="modalgrid">
        <div class="field"><label>ImiÄ™ i nazwisko</label><input class="input" id="eName"></div>
        <div class="field"><label>Telefon</label><input class="input" id="ePhone"></div>
        <div class="field"><label>Data</label><input class="input" id="eDate" type="date"></div>
        <div class="field"><label>Godzina</label><input class="input" id="eTime" type="time"></div>
        <div class="field"><label>IloÅ›Ä‡ osÃ³b</label><input class="input" id="eGuests"></div>
        <div class="field"><label>Strefa</label><input class="input" id="eRoom"></div>
        <div class="field" style="grid-column:span 2"><label>Uwagi</label><input class="input" id="eNotes"></div>
        <div class="field"><label>Å¹rÃ³dÅ‚o</label><input class="input" id="eSource" disabled></div>
        <div class="field"><label>Utworzono</label><input class="input" id="eCreated" disabled></div>
      </div>

      <div class="modalfoot">
        <button class="btn" id="editCancel"><i class="fa-regular fa-circle-xmark"></i> Anuluj</button>
        <button class="btn primary" id="editSave"><i class="fa-solid fa-floppy-disk"></i> Zapisz</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" style="
    position:fixed;bottom:18px;right:18px;z-index:12000;
    display:none;align-items:center;gap:10px;
    padding:12px 14px;border-radius:999px;
    background: rgba(22,163,74,0.22);
    border:1px solid rgba(22,163,74,0.35);
    color:#fff;backdrop-filter: blur(12px);
    box-shadow: 0 18px 45px rgba(0,0,0,0.35);
    font-weight:800;
  ">
    <i class="fa-solid fa-circle-check"></i>
    <span id="toastText"></span>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    // ==========================
    // Helpers
    // ==========================
    const $ = (q, el=document) => el.querySelector(q);
    const $$ = (q, el=document) => Array.from(el.querySelectorAll(q));

    const state = {
      pin: "",
      okPin: "0051",
      unlocked: false,
      reservations: [],
      editingId: null,
      alarmActive: false,
      audioCtx: null,
      beepInterval: null
    };

    function showToast(msg, bad=false){
      const t = $("#toast");
      const tt = $("#toastText");
      tt.textContent = msg;
      t.style.display = "flex";
      t.style.background = bad ? "rgba(220,38,38,0.20)" : "rgba(22,163,74,0.22)";
      t.style.borderColor = bad ? "rgba(220,38,38,0.35)" : "rgba(22,163,74,0.35)";
      setTimeout(()=> t.style.display="none", 3200);
    }

    function fmtDateTime(r){
      const d = (r?.date || "â€”");
      const t = (r?.time || "â€”");
      return `${d} â€¢ ${t}`;
    }

    function escapeHtml(s){
      return String(s ?? "").replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    // ==========================
    // Lock screen PIN
    // ==========================
    function renderPin(){
      const dots = [$("#p1"), $("#p2"), $("#p3"), $("#p4")];
      dots.forEach((d,i)=> d.classList.toggle("filled", i < state.pin.length));
    }

    function setLockMsg(msg, bad=false){
      const el = $("#lockMsg");
      el.textContent = msg || "";
      el.style.color = bad ? "rgba(255,200,200,0.95)" : "rgba(255,255,255,0.85)";
    }

    function unlock(){
      state.unlocked = true;
      $("#lock").classList.remove("show");
      $("#app").style.display = "grid";
      showToast("Zalogowano âœ…");
      initApp();
    }

    function lock(){
      state.unlocked = false;
      state.pin = "";
      renderPin();
      $("#app").style.display = "none";
      $("#lock").classList.add("show");
      setLockMsg("");
      stopAlarm();
    }

    $("#keypad").addEventListener("click", (e)=>{
      const btn = e.target.closest("button");
      if(!btn) return;

      const k = btn.getAttribute("data-k");
      const act = btn.getAttribute("data-act");

      if(k){
        if(state.pin.length >= 4) return;
        state.pin += k;
        renderPin();
        setLockMsg("");
        if(state.pin.length === 4){
          if(state.pin === state.okPin){
            unlock();
          }else{
            setLockMsg("BÅ‚Ä™dny PIN", true);
            state.pin = "";
            renderPin();
          }
        }
        return;
      }

      if(act === "back"){
        state.pin = state.pin.slice(0, -1);
        renderPin();
        setLockMsg("");
      }
      if(act === "ok"){
        if(state.pin === state.okPin){
          unlock();
        }else{
          setLockMsg("BÅ‚Ä™dny PIN", true);
          state.pin = "";
          renderPin();
        }
      }
    });

    // (opcjonalnie) blokujemy wpisywanie z fizycznej klawiatury: tylko keypad
    window.addEventListener("keydown", (e)=>{
      if(!$("#lock").classList.contains("show")) return;
      e.preventDefault();
    }, {passive:false});

    $("#logoutBtn").addEventListener("click", lock);

    // ==========================
    // Tabs
    // ==========================
    const tabMeta = {
      reservations: { title:"Rezerwacje", subtitle:"Lista rezerwacji z DB. Realtime przez Socket.IO." },
      happy: { title:"Pasek info", subtitle:"Tekst paska (Happy Bar) + realtime update na stronie." },
      users: { title:"UÅ¼ytkownicy", subtitle:"Placeholder (brak endpointÃ³w w minimalnym server.js)." },
      employees: { title:"Pracownicy", subtitle:"Placeholder (brak endpointÃ³w w minimalnym server.js)." },
      future: { title:"PrzyszÅ‚oÅ›ciowe zakÅ‚adki", subtitle:"Miejsce na nowe moduÅ‚y." },
      pickup: { title:"ZamÃ³wienie z odbiorem", subtitle:"Placeholder â€” kolekcja orders istnieje, brak endpointÃ³w." },
      points: { title:"Punkty Milk", subtitle:"Placeholder â€” do podpiÄ™cia API punktÃ³w." },
      rewards: { title:"Nagrody", subtitle:"Placeholder â€” do podpiÄ™cia API nagrÃ³d." },
    };

    function showTab(key){
      $$(".navbtn").forEach(b => b.classList.toggle("active", b.dataset.tab === key));
      Object.keys(tabMeta).forEach(k=>{
        const sec = $("#tab-" + k);
        if(sec) sec.style.display = (k === key) ? "block" : "none";
      });
      $("#title").textContent = tabMeta[key]?.title || "Panel";
      $("#subtitle").textContent = tabMeta[key]?.subtitle || "";
    }

    $$(".navbtn").forEach(b => b.addEventListener("click", ()=> showTab(b.dataset.tab)));

    // ==========================
    // API
    // ==========================
    async function apiHealth(){
      try{
        const res = await fetch("/api/health", {cache:"no-store"});
        const ok = res.ok;
        $("#apiDot").classList.toggle("ok", ok);
        $("#apiDot").classList.toggle("dot", true);
      }catch{
        $("#apiDot").classList.remove("ok");
      }
    }

    async function loadStats(){
      try{
        const res = await fetch("/api/admin/stats", {cache:"no-store"});
        const data = await res.json();
        if(!data?.ok) throw new Error("no ok");
        $("#kUsers").textContent = data.users ?? 0;
        $("#kOrders").textContent = data.orders ?? 0;
        $("#kProducts").textContent = data.products ?? 0;
        $("#kReservations").textContent = data.reservations ?? 0;
      }catch{
        $("#kUsers").textContent = "â€”";
        $("#kOrders").textContent = "â€”";
        $("#kProducts").textContent = "â€”";
        $("#kReservations").textContent = "â€”";
      }
    }

    async function loadReservations(){
      try{
        const res = await fetch("/api/rezerwacje", {cache:"no-store"});
        const list = await res.json();
        state.reservations = Array.isArray(list) ? list : [];
        renderReservations();
        $("#kReservations").textContent = state.reservations.length;
      }catch(e){
        console.error(e);
        showToast("Nie udaÅ‚o siÄ™ pobraÄ‡ rezerwacji", true);
      }
    }

    function renderReservations(){
      const tb = $("#resTbody");
      if(!tb) return;
      tb.innerHTML = "";

      if(state.reservations.length === 0){
        tb.innerHTML = `
          <tr>
            <td colspan="6" style="text-align:center;color:rgba(255,255,255,0.75);padding:18px;border-radius:16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.10)">
              Brak rezerwacji
            </td>
          </tr>
        `;
        return;
      }

      for(const r of state.reservations){
        const tr = document.createElement("tr");

        const src = (r.source || "index");
        const created = r.createdAt ? new Date(r.createdAt).toLocaleString("pl-PL") : "â€”";

        tr.innerHTML = `
          <td>
            <div class="tag"><i class="fa-regular fa-calendar"></i> ${escapeHtml(fmtDateTime(r))}</div>
            <div style="color:rgba(255,255,255,0.68);font-size:.82rem;margin-top:6px">Utworzono: ${escapeHtml(created)}</div>
          </td>
          <td>
            <div style="font-weight:900">${escapeHtml(r.name || "â€”")}</div>
            <div style="color:rgba(255,255,255,0.75);font-size:.9rem;margin-top:4px"><i class="fa-solid fa-phone"></i> ${escapeHtml(r.phone || "â€”")}</div>
          </td>
          <td><span class="tag"><i class="fa-solid fa-user-group"></i> ${escapeHtml(r.guests || "â€”")} <small>os.</small></span></td>
          <td><span class="tag"><i class="fa-solid fa-door-open"></i> ${escapeHtml(r.room || "â€”")}</span></td>
          <td><span class="tag"><i class="fa-solid fa-globe"></i> ${escapeHtml(src)}</span></td>
          <td>
            <div class="row-actions">
              <button class="iconbtn ok" title="Edytuj" data-act="edit" data-id="${r._id}"><i class="fa-solid fa-pen"></i></button>
              <button class="iconbtn danger" title="UsuÅ„" data-act="del" data-id="${r._id}"><i class="fa-solid fa-trash"></i></button>
            </div>
          </td>
        `;

        tb.appendChild(tr);
      }
    }

    $("#resTbody").addEventListener("click", async (e)=>{
      const btn = e.target.closest("button");
      if(!btn) return;
      const id = btn.getAttribute("data-id");
      const act = btn.getAttribute("data-act");
      if(!id || !act) return;

      const r = state.reservations.find(x => x._id === id);
      if(!r) return;

      if(act === "edit"){
        openEdit(r);
      }
      if(act === "del"){
        if(!confirm("UsunÄ…Ä‡ rezerwacjÄ™?")) return;
        try{
          const res = await fetch(`/api/rezerwacje/${id}`, { method:"DELETE" });
          const data = await res.json().catch(()=>({}));
          if(!res.ok || data?.ok === false) throw new Error(data?.message || "delete");
          showToast("UsuniÄ™to âœ…");
          await loadReservations();
          await loadStats();
        }catch(err){
          console.error(err);
          showToast("BÅ‚Ä…d usuwania", true);
        }
      }
    });

    // ==========================
    // Edit modal
    // ==========================
    function openEdit(r){
      state.editingId = r._id;
      $("#eName").value = r.name || "";
      $("#ePhone").value = r.phone || "";
      $("#eDate").value = r.date || "";
      $("#eTime").value = r.time || "";
      $("#eGuests").value = r.guests || "";
      $("#eRoom").value = r.room || "";
      $("#eNotes").value = r.notes || "";
      $("#eSource").value = r.source || "index";
      $("#eCreated").value = r.createdAt ? new Date(r.createdAt).toLocaleString("pl-PL") : "â€”";
      $("#editModal").classList.add("show");
      $("#editModal").setAttribute("aria-hidden","false");
    }

    function closeEdit(){
      state.editingId = null;
      $("#editModal").classList.remove("show");
      $("#editModal").setAttribute("aria-hidden","true");
    }

    $("#editClose").addEventListener("click", closeEdit);
    $("#editCancel").addEventListener("click", closeEdit);
    $("#editModal").addEventListener("click", (e)=>{
      if(e.target.id === "editModal") closeEdit();
    });

    $("#editSave").addEventListener("click", async ()=>{
      const id = state.editingId;
      if(!id) return;

      const payload = {
        name: $("#eName").value,
        phone: $("#ePhone").value,
        date: $("#eDate").value,
        time: $("#eTime").value,
        guests: $("#eGuests").value,
        room: $("#eRoom").value,
        notes: $("#eNotes").value
      };

      try{
        const res = await fetch(`/api/rezerwacje/${id}`, {
          method:"PUT",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });
        const data = await res.json().catch(()=>({}));
        if(!res.ok || data?.ok === false) throw new Error(data?.message || "edit");
        showToast("Zapisano âœ…");
        closeEdit();
        await loadReservations();
      }catch(err){
        console.error(err);
        showToast("BÅ‚Ä…d zapisu", true);
      }
    });

    // ==========================
    // Happy bar
    // ==========================
    async function loadHappy(){
      try{
        const res = await fetch("/api/happy", {cache:"no-store"});
        const data = await res.json();
        if(!data?.ok) throw new Error("happy");
        $("#happyText").value = data.happy || "";
        showToast("Wczytano âœ…");
      }catch(e){
        console.error(e);
        showToast("BÅ‚Ä…d wczytywania paska", true);
      }
    }
    async function saveHappy(){
      try{
        const text = $("#happyText").value || "";
        const res = await fetch("/api/happy", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ happy: text })
        });
        const data = await res.json().catch(()=>({}));
        if(!res.ok || data?.ok === false) throw new Error(data?.message || "save");
        showToast("Zapisano + realtime âœ…");
      }catch(e){
        console.error(e);
        showToast("BÅ‚Ä…d zapisu paska", true);
      }
    }
    $("#happyLoad").addEventListener("click", loadHappy);
    $("#happySave").addEventListener("click", saveHappy);

    // ==========================
    // Alarm: migawka + beep do OK
    // ==========================
    function ensureAudio(){
      if(state.audioCtx) return;
      try{
        state.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }catch(e){
        state.audioCtx = null;
      }
    }

    function beepOnce(){
      if(!state.audioCtx) return;
      const ctx = state.audioCtx;
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = "square";
      o.frequency.value = 880;
      g.gain.value = 0.06;
      o.connect(g);
      g.connect(ctx.destination);
      o.start();
      setTimeout(()=>{ try{o.stop();}catch(e){} }, 160);
    }

    function startAlarm(reservation){
      if(state.alarmActive) return; // juÅ¼ aktywny
      state.alarmActive = true;

      // preview
      $("#alarmPreview").innerHTML = `
        <div><b>${escapeHtml(reservation?.name || "â€”")}</b> â€¢ ${escapeHtml(reservation?.phone || "â€”")}</div>
        <div>ðŸ“… ${escapeHtml(reservation?.date || "â€”")} â€¢ ðŸ•’ ${escapeHtml(reservation?.time || "â€”")}</div>
        <div>ðŸ‘¥ ${escapeHtml(reservation?.guests || "â€”")} â€¢ ðŸšª ${escapeHtml(reservation?.room || "â€”")}</div>
        <div style="margin-top:8px;color:rgba(255,255,255,0.75)">${escapeHtml(reservation?.notes || "")}</div>
      `;

      const alarm = $("#alarm");
      alarm.classList.add("show");
      alarm.classList.add("flash");

      // audio beep loop
      ensureAudio();
      if(state.audioCtx && state.audioCtx.state === "suspended"){
        // prÃ³ba resume (zwykle dziaÅ‚a po pierwszej interakcji z panelem)
        state.audioCtx.resume().catch(()=>{});
      }

      beepOnce();
      state.beepInterval = setInterval(beepOnce, 650);
    }

    function stopAlarm(){
      state.alarmActive = false;
      const alarm = $("#alarm");
      alarm.classList.remove("show");
      alarm.classList.remove("flash");
      if(state.beepInterval){
        clearInterval(state.beepInterval);
        state.beepInterval = null;
      }
    }

    $("#alarmOk").addEventListener("click", ()=>{
      stopAlarm();
      showToast("Potwierdzono powiadomienie âœ…");
    });

    // ==========================
    // Realtime (Socket.IO)
    // ==========================
    let socket = null;

    function initSocket(){
      try{
        socket = io();

        socket.on("new-reservation", async (reservation)=>{
          // 1) alarm + beep + migawka do OK
          startAlarm(reservation);

          // 2) aktualizacja listy
          await loadReservations();
          await loadStats();
        });

        socket.on("happy-updated", (text)=>{
          // jeÅ¼eli jesteÅ›my w zakÅ‚adce "pasek info", aktualizuj pole
          if($("#tab-happy").style.display !== "none"){
            $("#happyText").value = text || "";
          }
          showToast("Pasek info zaktualizowany (realtime) âœ…");
        });

        socket.on("connect_error", ()=>{});
      }catch(e){
        console.error("Socket init error", e);
      }
    }

    // ==========================
    // Init
    // ==========================
    async function initApp(){
      showTab("reservations");
      initSocket();
      await apiHealth();
      await loadStats();
      await loadReservations();
      await loadHappy();
    }

    $("#refreshBtn").addEventListener("click", async ()=>{
      await apiHealth();
      await loadStats();
      await loadReservations();
      showToast("OdÅ›wieÅ¼ono âœ…");
    });

    // clock
    setInterval(()=>{
      const now = new Date();
      $("#clock").innerHTML = `<i class="fa-regular fa-clock"></i> ${now.toLocaleTimeString("pl-PL",{hour:"2-digit",minute:"2-digit"})}`;
    }, 1000);

    // health periodic
    setInterval(apiHealth, 6000);

    // start locked by default
    renderPin();
  </script>
</body>
</html>
